
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WELCOME</title>
    <style>
        /* * {
            background-color: rgb(71, 72, 79);
            color: white;
            text-align: center;
        }
        header {
            height: 20%;
            font-size: 4vw;
        }
        main {
            height: 60%;
            font-size: 2vw;
        }
        footer {
            font-size: 2vw;
            height: 20%;
        }
        body{
            height: 100vh;
        } */
    </style>
</head>
<body>
    <header>
        WELCOME
    </header>
    <main>
        <form id="myform">
            用户：<input type="text" name="userName">
            <hr>
            密码：<input type="text" name="passWord">
            <hr>
            <button id="login" type="button">登录</button>
            <button id="signin" type="button">注册</button>
        </form>
    </main>
    <footer>
    </footer>
    <script>
        function select(str) {
            return document.querySelector(str);
        }
        UI = {};
        Model = {};
        Model.users = [];
        if(localStorage.getItem('users')){
            Model.users = JSON.parse(localStorage.getItem('users'));
        }
        else{
            Model.users.push({userName: "mike", passWord: "1234"});
        }
        
        UI.log = function(s) {
            select("footer").textContent = s;
        }
        UI.form = select("form#myform");
        //登录
        select("#login").onclick = function(event){
            event.preventDefault();
            let name = UI.form.userName.value;
            let pass = UI.form.passWord.value;
            console.log(name + pass);
            let tag = 0;
            for(o of Model.users){
                if(o.userName === name){
                    // tag = 1;
                    if(pass === o.passWord){
                        //登录成功
                        UI.log("登录成功");
                        location.assign("/book.html");
                    }
                    else{
                        //密码错误
                        UI.log("登录失败，密码错误")
                    }
                    return;
                }
            }
            //用户名不存在
            UI.log("登录失败，用户名不存在");
        }
        //注册
        select("#signin").onclick = function(event){
            event.preventDefault();
            
            let name = UI.form.userName.value.trim();
            let pass = UI.form.passWord.value.trim();


            if(name === "" || pass === ""){
                UI.log("用户名或密码不能为空！");
                return;
            }

            console.log(name + pass);
            let tag = 0;
            for(o of Model.users){
                if(o.userName === name){
                    tag = 1;
                    break;
                }
            }
            if(tag === 1){
                UI.log("注册失败，用户名‘" + name + "’已存在");
                console.log("222");
            }
            else{
                let user = {userName: name, passWord: pass};
                Model.users.push(user);
                localStorage.setItem('users',JSON.stringify(Model.users));
                UI.log("注册成功，你的用户名是‘" + name + "’");
                console.log("333");
            }
        }
    </script>
</body>
</html>
